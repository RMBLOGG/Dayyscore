{% extends "base.html" %}
{% block content %}

<style>
/* ===== TEAM DETAIL PAGE ===== */
.team-detail-container {
    max-width: 1200px;
    margin: 0 auto;
}

.team-header {
    background: linear-gradient(135deg, #0f2027 0%, #203a43 100%);
    border-radius: 20px;
    padding: 30px;
    margin-bottom: 30px;
    position: relative;
    overflow: hidden;
}

.team-header::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100" preserveAspectRatio="none"><path d="M0,0 L100,0 L100,100 Z" fill="rgba(0,255,204,0.1)"/></svg>');
    opacity: 0.3;
}

.team-basic-info {
    display: flex;
    align-items: center;
    gap: 30px;
    position: relative;
    z-index: 1;
}

.team-crest-large {
    width: 150px;
    height: 150px;
    object-fit: contain;
    filter: drop-shadow(0 5px 15px rgba(0,0,0,0.3));
}

.team-info-details {
    flex: 1;
}

.team-name-large {
    font-size: 2.5rem;
    font-weight: 800;
    color: #00ffcc;
    margin-bottom: 10px;
}

.team-short-name {
    font-size: 1.5rem;
    opacity: 0.8;
    margin-bottom: 20px;
}

.team-meta {
    display: flex;
    flex-wrap: wrap;
    gap: 20px;
    margin-bottom: 20px;
}

.meta-item {
    display: flex;
    align-items: center;
    gap: 8px;
    font-size: 1rem;
}

.meta-item i {
    color: #00ffcc;
}

.team-colors {
    display: flex;
    gap: 10px;
    align-items: center;
}

.color-box {
    width: 30px;
    height: 30px;
    border-radius: 6px;
    border: 2px solid rgba(255,255,255,0.2);
}

.team-actions {
    position: absolute;
    top: 30px;
    right: 30px;
    display: flex;
    gap: 15px;
}

/* Coach Info */
.coach-card {
    background: linear-gradient(145deg, #0a0f14, #131b23);
    border-radius: 16px;
    padding: 20px;
    margin-bottom: 30px;
    border: 1px solid rgba(0, 255, 204, 0.2);
    display: flex;
    align-items: center;
    gap: 20px;
}

.coach-photo {
    width: 100px;
    height: 100px;
    border-radius: 50%;
    object-fit: cover;
    border: 3px solid #00ffcc;
}

.coach-info h3 {
    color: #00ffcc;
    margin-bottom: 10px;
    font-size: 1.3rem;
}

.coach-info p {
    opacity: 0.8;
    margin-bottom: 5px;
}

/* Tabs */
.team-tabs {
    display: flex;
    gap: 10px;
    margin-bottom: 30px;
    background: rgba(0,0,0,0.3);
    padding: 10px;
    border-radius: 12px;
}

.tab-btn {
    background: transparent;
    border: none;
    color: #ccc;
    padding: 12px 24px;
    border-radius: 8px;
    cursor: pointer;
    font-size: 1rem;
    font-weight: 600;
    transition: all 0.2s;
}

.tab-btn.active {
    background: rgba(0, 255, 204, 0.2);
    color: #00ffcc;
}

.tab-btn:hover:not(.active) {
    background: rgba(255,255,255,0.1);
}

.tab-content {
    display: none;
}

.tab-content.active {
    display: block;
    animation: fadeIn 0.3s ease;
}

@keyframes fadeIn {
    from { opacity: 0; transform: translateY(10px); }
    to { opacity: 1; transform: translateY(0); }
}

/* Squad Preview */
.squad-preview {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
    gap: 15px;
    margin-top: 20px;
}

.squad-player-card {
    background: rgba(0,0,0,0.3);
    border-radius: 12px;
    padding: 15px;
    display: flex;
    align-items: center;
    gap: 12px;
    cursor: pointer;
    transition: all 0.2s;
}

.squad-player-card:hover {
    background: rgba(0,0,0,0.5);
    transform: translateY(-3px);
}

.player-number {
    width: 40px;
    height: 40px;
    background: #00ffcc;
    color: #000;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: 800;
    font-size: 1.1rem;
}

.player-info-small {
    flex: 1;
}

.player-name-small {
    font-weight: 600;
    font-size: 0.9rem;
    margin-bottom: 4px;
}

.player-position-small {
    font-size: 0.8rem;
    opacity: 0.7;
}

/* Recent Matches */
.recent-matches-container {
    background: linear-gradient(145deg, #0a0f14, #131b23);
    border-radius: 16px;
    padding: 25px;
    border: 1px solid rgba(0, 255, 204, 0.2);
}

.match-card-team {
    background: rgba(0,0,0,0.3);
    border-radius: 12px;
    padding: 15px;
    margin-bottom: 15px;
    transition: all 0.2s;
    cursor: pointer;
}

.match-card-team:hover {
    background: rgba(0,0,0,0.5);
    border-left: 3px solid #00ffcc;
}

.match-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 10px;
}

.match-date {
    font-size: 0.9rem;
    opacity: 0.8;
}

.match-competition {
    font-size: 0.8rem;
    background: rgba(0, 255, 204, 0.2);
    color: #00ffcc;
    padding: 4px 10px;
    border-radius: 12px;
}

.match-teams {
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: 20px;
}

.match-team {
    display: flex;
    align-items: center;
    gap: 10px;
    width: 40%;
}

.team-logo-match {
    width: 30px;
    height: 30px;
    object-fit: contain;
}

.match-score {
    font-size: 1.5rem;
    font-weight: 800;
    padding: 8px 16px;
    background: rgba(0,0,0,0.5);
    border-radius: 10px;
    min-width: 100px;
    text-align: center;
}

/* Venue Info */
.venue-card {
    background: linear-gradient(145deg, #0a0f14, #131b23);
    border-radius: 16px;
    padding: 25px;
    border: 1px solid rgba(0, 255, 204, 0.2);
}

.venue-name {
    font-size: 1.5rem;
    color: #00ffcc;
    margin-bottom: 15px;
}

.venue-details {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 15px;
    margin-top: 20px;
}

.venue-detail {
    background: rgba(0,0,0,0.3);
    padding: 15px;
    border-radius: 10px;
    text-align: center;
}

.venue-detail-label {
    font-size: 0.9rem;
    opacity: 0.8;
    margin-bottom: 5px;
}

.venue-detail-value {
    font-size: 1.2rem;
    font-weight: 700;
    color: #00ffcc;
}

/* Responsive */
@media (max-width: 768px) {
    .team-basic-info {
        flex-direction: column;
        text-align: center;
    }
    
    .team-actions {
        position: relative;
        top: 0;
        right: 0;
        justify-content: center;
        margin-top: 20px;
    }
    
    .team-tabs {
        overflow-x: auto;
        flex-wrap: nowrap;
        padding: 10px 5px;
    }
    
    .tab-btn {
        padding: 10px 15px;
        font-size: 0.9rem;
        white-space: nowrap;
    }
}
</style>

<div class="team-detail-container">
    <!-- Team Header -->
    <div class="team-header">
        <div class="team-basic-info">
            {% if team.crest %}
            <img src="{{ team.crest }}" alt="{{ team.name }}" class="team-crest-large">
            {% endif %}
            
            <div class="team-info-details">
                <h1 class="team-name-large">{{ team.name }}</h1>
                
                {% if team.shortName %}
                <div class="team-short-name">{{ team.shortName }}</div>
                {% endif %}
                
                <div class="team-meta">
                    {% if team.founded %}
                    <div class="meta-item">
                        <i class="bi bi-calendar-event"></i>
                        <span>Founded: {{ team.founded }}</span>
                    </div>
                    {% endif %}
                    
                    {% if team.clubColors %}
                    <div class="meta-item">
                        <i class="bi bi-palette"></i>
                        <span>Colors:</span>
                        <div class="team-colors">
                            {% for color in team.clubColors.split('/') %}
                            <div class="color-box" style="background-color: {{ color.strip() }};"></div>
                            {% endfor %}
                        </div>
                    </div>
                    {% endif %}
                    
                    {% if team.venue %}
                    <div class="meta-item">
                        <i class="bi bi-geo-alt"></i>
                        <span>{{ team.venue }}</span>
                    </div>
                    {% endif %}
                    
                    {% if team.address %}
                    <div class="meta-item">
                        <i class="bi bi-house"></i>
                        <span>{{ team.address }}</span>
                    </div>
                    {% endif %}
                </div>
                
                {% if team.website %}
                <div class="meta-item">
                    <i class="bi bi-globe"></i>
                    <a href="{{ team.website }}" target="_blank" style="color: #00ffcc;">Official Website</a>
                </div>
                {% endif %}
            </div>
        </div>
        
        <div class="team-actions">
            <button class="action-btn favorite {% if is_favorite %}active{% endif %}" onclick="toggleFavoriteTeam({{ team.id }})">
                <i class="bi bi-heart{% if is_favorite %}-fill{% endif %}"></i>
            </button>
            <button class="action-btn" onclick="window.location.href='/team/{{ team.id }}/squad'">
                <i class="bi bi-people"></i>
            </button>
            <button class="action-btn" onclick="shareTeam()">
                <i class="bi bi-share"></i>
            </button>
        </div>
    </div>
    
    <!-- Coach Information -->
    {% if coach %}
    <div class="coach-card">
        {% if coach.photo %}
        <img src="{{ coach.photo }}" alt="{{ coach.name }}" class="coach-photo">
        {% endif %}
        
        <div class="coach-info">
            <h3>{{ coach.name }}</h3>
            {% if coach.nationality %}
            <p><i class="bi bi-flag"></i> {{ coach.nationality }}</p>
            {% endif %}
            
            {% if coach.dateOfBirth %}
            <p><i class="bi bi-calendar"></i> Born: {{ coach.dateOfBirth }}</p>
            {% endif %}
            
            {% if coach.contract and coach.contract.start %}
            <p><i class="bi bi-file-earmark-text"></i> Contract: {{ coach.contract.start }} - {{ coach.contract.until }}</p>
            {% endif %}
            
            <button class="tab-btn" onclick="window.location.href='/coach/{{ coach.id }}'" style="margin-top: 10px; padding: 8px 16px; font-size: 0.9rem;">
                View Coach Profile
            </button>
        </div>
    </div>
    {% endif %}
    
    <!-- Tabs -->
    <div class="team-tabs">
        <button class="tab-btn active" onclick="switchTab('overview')">Overview</button>
        <button class="tab-btn" onclick="switchTab('squad')">Squad</button>
        <button class="tab-btn" onclick="switchTab('matches')">Matches</button>
        <button class="tab-btn" onclick="switchTab('venue')">Venue</button>
        {% if team.runningCompetitions %}
        <button class="tab-btn" onclick="switchTab('competitions')">Competitions</button>
        {% endif %}
    </div>
    
    <!-- Overview Tab -->
    <div id="overview-tab" class="tab-content active">
        <div class="stats-grid" style="margin-bottom: 30px;">
            <div class="stat-card">
                <div class="stat-card-title">
                    <i class="bi bi-people"></i>
                    Squad Size
                </div>
                <div class="stat-value-large">
                    {{ squad|length if squad else 0 }}
                </div>
                <div class="stat-label">Players</div>
            </div>
            
            <div class="stat-card">
                <div class="stat-card-title">
                    <i class="bi bi-trophy"></i>
                    Competitions
                </div>
                <div class="stat-value-large">
                    {{ team.runningCompetitions|length if team.runningCompetitions else 0 }}
                </div>
                <div class="stat-label">Active</div>
            </div>
            
            <div class="stat-card">
                <div class="stat-card-title">
                    <i class="bi bi-cash-stack"></i>
                    Market Value
                </div>
                <div class="stat-value-large" style="font-size: 2rem;">
                    {{ team.squadMarketValue if team.squadMarketValue else 'N/A' }}
                </div>
                <div class="stat-label">Squad Value</div>
            </div>
            
            <div class="stat-card">
                <div class="stat-card-title">
                    <i class="bi bi-award"></i>
                    Last 5
                </div>
                <div class="stat-value-large">
                    {% set recent_form = calculate_form(matches[:5]) %}
                    {{ recent_form.wins }}/{{ recent_form.draws }}/{{ recent_form.losses }}
                </div>
                <div class="stat-label">W/D/L</div>
            </div>
        </div>
        
        <!-- Squad Preview -->
        <div class="recent-matches-container">
            <h3 style="color: #00ffcc; margin-bottom: 20px;">
                <i class="bi bi-people"></i> Key Players
            </h3>
            
            {% if squad %}
            <div class="squad-preview">
                {% for player in squad[:12] %}
                <div class="squad-player-card" onclick="window.location.href='/player/{{ player.id }}'">
                    <div class="player-number">
                        {{ player.shirtNumber if player.shirtNumber else '?' }}
                    </div>
                    <div class="player-info-small">
                        <div class="player-name-small">{{ player.name }}</div>
                        <div class="player-position-small">{{ player.position|get_position }}</div>
                    </div>
                </div>
                {% endfor %}
            </div>
            
            <div style="text-align: center; margin-top: 20px;">
                <button class="tab-btn" onclick="window.location.href='/team/{{ team.id }}/squad'">
                    View Full Squad
                </button>
            </div>
            {% else %}
            <div style="text-align: center; padding: 40px; opacity: 0.6;">
                <i class="bi bi-people" style="font-size: 3rem;"></i>
                <div>No squad data available</div>
            </div>
            {% endif %}
        </div>
    </div>
    
    <!-- Squad Tab -->
    <div id="squad-tab" class="tab-content">
        <div class="recent-matches-container">
            <h3 style="color: #00ffcc; margin-bottom: 20px;">
                <i class="bi bi-people"></i> Full Squad
            </h3>
            
            {% if squad %}
            <!-- Filter by position -->
            <div style="margin-bottom: 20px; display: flex; gap: 10px; flex-wrap: wrap;">
                <button class="position-filter active" onclick="filterSquad('all')">All</button>
                <button class="position-filter" onclick="filterSquad('Goalkeeper')">Goalkeepers</button>
                <button class="position-filter" onclick="filterSquad('Defender')">Defenders</button>
                <button class="position-filter" onclick="filterSquad('Midfielder')">Midfielders</button>
                <button class="position-filter" onclick="filterSquad('Forward')">Forwards</button>
            </div>
            
            <div id="squad-container" class="squad-preview">
                {% for player in squad %}
                <div class="squad-player-card" onclick="window.location.href='/player/{{ player.id }}'" data-position="{{ player.position }}">
                    <div class="player-number">
                        {{ player.shirtNumber if player.shirtNumber else '?' }}
                    </div>
                    <div class="player-info-small">
                        <div class="player-name-small">{{ player.name }}</div>
                        <div class="player-position-small">{{ player.position|get_position }}</div>
                    </div>
                </div>
                {% endfor %}
            </div>
            {% else %}
            <div style="text-align: center; padding: 40px; opacity: 0.6;">
                <i class="bi bi-people" style="font-size: 3rem;"></i>
                <div>No squad data available</div>
            </div>
            {% endif %}
        </div>
    </div>
    
    <!-- Matches Tab -->
    <div id="matches-tab" class="tab-content">
        <div class="recent-matches-container">
            <h3 style="color: #00ffcc; margin-bottom: 20px;">
                <i class="bi bi-calendar-week"></i> Recent Matches
            </h3>
            
            {% if matches %}
            {% for match in matches %}
            <div class="match-card-team" onclick="window.location.href='/match/{{ match.id }}'">
                <div class="match-header">
                    <div class="match-date">
                        {{ match.utcDate|datetimeformat('%d %b %Y, %H:%M') }}
                    </div>
                    {% if match.competition %}
                    <div class="match-competition">
                        {{ match.competition.name }}
                    </div>
                    {% endif %}
                </div>
                
                <div class="match-teams">
                    <div class="match-team">
                        <img src="{{ match.homeTeam.crest }}" alt="{{ match.homeTeam.name }}" class="team-logo-match">
                        <span>{{ match.homeTeam.shortName or match.homeTeam.name }}</span>
                    </div>
                    
                    <div class="match-score">
                        {{ match.score.fullTime.home if match.score and match.score.fullTime and match.score.fullTime.home is not none else '0' }} - 
                        {{ match.score.fullTime.away if match.score and match.score.fullTime and match.score.fullTime.away is not none else '0' }}
                    </div>
                    
                    <div class="match-team" style="justify-content: flex-end;">
                        <span>{{ match.awayTeam.shortName or match.awayTeam.name }}</span>
                        <img src="{{ match.awayTeam.crest }}" alt="{{ match.awayTeam.name }}" class="team-logo-match">
                    </div>
                </div>
                
                {% if match.status %}
                <div style="margin-top: 10px; font-size: 0.8rem; opacity: 0.8;">
                    Status: {{ match.status }}
                    {% if match.minute %}
                    <span style="margin-left: 10px; color: #ff4d4d;">{{ match.minute }}'</span>
                    {% endif %}
                </div>
                {% endif %}
            </div>
            {% endfor %}
            
            <div style="text-align: center; margin-top: 20px;">
                <button class="tab-btn" onclick="loadMoreMatches()">
                    Load More Matches
                </button>
            </div>
            {% else %}
            <div style="text-align: center; padding: 40px; opacity: 0.6;">
                <i class="bi bi-calendar-x" style="font-size: 3rem;"></i>
                <div>No match data available</div>
            </div>
            {% endif %}
        </div>
    </div>
    
    <!-- Venue Tab -->
    <div id="venue-tab" class="tab-content">
        {% if team.venue %}
        <div class="venue-card">
            <h3 class="venue-name">{{ team.venue }}</h3>
            
            {% if team.address %}
            <div style="margin-bottom: 20px;">
                <i class="bi bi-geo-alt"></i>
                <span>{{ team.address }}</span>
            </div>
            {% endif %}
            
            <div class="venue-details">
                {% if team.area %}
                <div class="venue-detail">
                    <div class="venue-detail-label">Country</div>
                    <div class="venue-detail-value">{{ team.area.name }}</div>
                </div>
                {% endif %}
                
                {% if team.founded %}
                <div class="venue-detail">
                    <div class="venue-detail-label">Founded</div>
                    <div class="venue-detail-value">{{ team.founded }}</div>
                </div>
                {% endif %}
                
                <div class="venue-detail">
                    <div class="venue-detail-label">Colors</div>
                    <div class="venue-detail-value" style="font-size: 1rem;">
                        {% for color in team.clubColors.split('/') %}
                        <span style="display: inline-block; width: 20px; height: 20px; background-color: {{ color.strip() }}; margin: 0 2px; border-radius: 3px;"></span>
                        {% endfor %}
                    </div>
                </div>
            </div>
        </div>
        {% else %}
        <div class="recent-matches-container">
            <div style="text-align: center; padding: 40px; opacity: 0.6;">
                <i class="bi bi-building" style="font-size: 3rem;"></i>
                <div>No venue information available</div>
            </div>
        </div>
        {% endif %}
    </div>
    
    <!-- Competitions Tab -->
    {% if team.runningCompetitions %}
    <div id="competitions-tab" class="tab-content">
        <div class="recent-matches-container">
            <h3 style="color: #00ffcc; margin-bottom: 20px;">
                <i class="bi bi-trophy"></i> Active Competitions
            </h3>
            
            <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(250px, 1fr)); gap: 15px;">
                {% for competition in team.runningCompetitions %}
                <div style="background: rgba(0,0,0,0.3); padding: 20px; border-radius: 12px; text-align: center;">
                    {% if competition.emblem %}
                    <img src="{{ competition.emblem }}" alt="{{ competition.name }}" style="width: 60px; height: 60px; margin-bottom: 10px;">
                    {% endif %}
                    
                    <div style="font-weight: 600; margin-bottom: 10px;">{{ competition.name }}</div>
                    
                    {% if competition.code %}
                    <a href="/standings/{{ competition.code }}" style="color: #00ffcc; font-size: 0.9rem;">
                        View Standings
                    </a>
                    {% endif %}
                </div>
                {% endfor %}
            </div>
        </div>
    </div>
    {% endif %}
</div>

<script>
// Tab switching
function switchTab(tabName) {
    // Hide all tabs
    document.querySelectorAll('.tab-content').forEach(tab => {
        tab.classList.remove('active');
    });
    
    // Deactivate all buttons
    document.querySelectorAll('.tab-btn').forEach(btn => {
        btn.classList.remove('active');
    });
    
    // Show selected tab
    document.getElementById(`${tabName}-tab`).classList.add('active');
    
    // Activate clicked button
    event.target.classList.add('active');
}

// Squad filtering
function filterSquad(position) {
    const squadCards = document.querySelectorAll('#squad-container .squad-player-card');
    const filterButtons = document.querySelectorAll('.position-filter');
    
    // Update active filter button
    filterButtons.forEach(btn => {
        btn.classList.remove('active');
    });
    event.target.classList.add('active');
    
    // Filter cards
    squadCards.forEach(card => {
        if (position === 'all' || card.dataset.position === position) {
            card.style.display = 'flex';
        } else {
            card.style.display = 'none';
        }
    });
}

// Toggle favorite team
async function toggleFavoriteTeam(teamId) {
    const btn = document.querySelector('.favorite-btn');
    const icon = btn.querySelector('i');
    const isFavorite = icon.classList.contains('bi-heart-fill');
    
    try {
        if (isFavorite) {
            // Remove from favorites
            const response = await fetch(`/api/favorite/team/${teamId}`, {
                method: 'DELETE',
                headers: {
                    'Content-Type': 'application/json'
                }
            });
            
            if (response.ok) {
                icon.classList.remove('bi-heart-fill');
                icon.classList.add('bi-heart');
                btn.classList.remove('active');
                showNotification('Removed from favorites', 'info');
            }
        } else {
            // Add to favorites
            const response = await fetch(`/api/favorite/team/${teamId}`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                }
            });
            
            if (response.ok) {
                icon.classList.remove('bi-heart');
                icon.classList.add('bi-heart-fill');
                btn.classList.add('active');
                showNotification('Added to favorites', 'success');
            }
        }
    } catch (error) {
        console.error('Error toggling favorite:', error);
        showNotification('Please login to use favorites', 'warning');
    }
}

// Share team
function shareTeam() {
    const teamName = "{{ team.name }}";
    const url = window.location.href;
    
    if (navigator.share) {
        navigator.share({
            title: `${teamName} - Football Team Profile`,
            text: `Check out ${teamName}'s profile on Football App`,
            url: url
        });
    } else {
        // Fallback: Copy to clipboard
        navigator.clipboard.writeText(url).then(() => {
            showNotification('Link copied to clipboard!', 'success');
        });
    }
}

// Load more matches (placeholder)
function loadMoreMatches() {
    // This would load more matches from API
    showNotification('Loading more matches...', 'info');
}

// Notification function
function showNotification(message, type = 'info') {
    // Similar to player_detail.html
    alert(message); // Simplified
}
</script>

{% endblock %}