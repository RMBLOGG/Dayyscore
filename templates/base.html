<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Football App</title>

<!-- BOOTSTRAP ICON -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css" rel="stylesheet">

<style>
/* =================================================
   UNIVERSAL OVERFLOW FIX - DIPERBAIKI
================================================= */

/* Reset dasar tapi lebih selektif */
* {
    box-sizing: border-box;
}

body, html {
    max-width: 100vw;
    overflow-x: hidden;
}

/* Hanya untuk elemen block yang rentan overflow */
div:not(.sidebar):not(.content):not(.topbar),
section, article, header:not(.topbar), footer, 
.container, .card, .box, .panel {
    max-width: 100%;
}

/* Untuk teks panjang - tapi tidak semua */
.league-name, .team-name, .app-title,
.filter-btn span, .league-filter span {
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    display: inline-block;
    max-width: 100%;
}

/* Untuk buttons dan inputs */
button, .btn, input, select, textarea {
    max-width: 100%;
}

/* Untuk images */
img {
    max-width: 100%;
    height: auto;
}

/* =========================
   ANDROID STYLE BASE - DIPERBAIKI
========================= */
body {
    margin: 0;
    background: #0e141b;
    color: #eaeaea;
    font-family: system-ui, -apple-system, "Segoe UI", Roboto, sans-serif;
    overflow-x: hidden;
}

/* TOP BAR - FIXED */
.topbar {
    height: 56px;
    background: #121a23;
    display: flex;
    align-items: center;
    padding: 0 16px;
    position: fixed;
    width: 100%;
    top: 0;
    z-index: 1000;
    box-shadow: 0 2px 10px rgba(0,0,0,0.5);
    box-sizing: border-box;
}

.menu-btn {
    font-size: 1.6rem;
    cursor: pointer;
    margin-right: 16px;
    flex-shrink: 0;
    color: #fff;
    transition: color 0.2s;
    z-index: 1101;
}

.menu-btn:hover {
    color: #00ffcc;
}

.app-title {
    font-weight: 700;
    font-size: 1.2rem;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    flex: 1;
    min-width: 0;
}

.admin-badge {
    margin-left: auto;
    background: #ff4d4d;
    color: white;
    padding: 4px 8px;
    border-radius: 8px;
    font-size: 0.7rem;
    font-weight: bold;
    white-space: nowrap;
    flex-shrink: 0;
    display: none;
}

/* SIDEBAR - DIPERBAIKI */
.sidebar {
    position: fixed;
    top: 0;
    left: -280px; /* Diperlebar sedikit */
    width: 280px;
    height: 100%;
    background: #0b1017;
    padding-top: 56px;
    transition: left 0.3s ease;
    z-index: 1100;
    overflow-y: auto;
    box-shadow: 2px 0 10px rgba(0,0,0,0.3);
}

.sidebar.active {
    left: 0;
}

.sidebar a {
    display: flex;
    align-items: center;
    gap: 14px;
    padding: 14px 20px;
    color: #ccc;
    text-decoration: none;
    transition: all 0.2s;
    border-left: 3px solid transparent;
    white-space: nowrap;
}

.sidebar a:hover {
    background: rgba(22, 32, 43, 0.8);
    color: #00ffcc;
    border-left-color: #00ffcc;
}

.sidebar a.active {
    background: #16202b;
    color: #00ffcc;
    border-left-color: #00ffcc;
}

.sidebar i {
    font-size: 1.3rem;
    flex-shrink: 0;
    width: 24px;
    text-align: center;
}

.sidebar-divider {
    margin: 10px 20px;
    font-size: 0.75rem;
    color: #777;
    text-transform: uppercase;
    letter-spacing: 1px;
    padding-top: 10px;
    border-top: 1px solid rgba(255,255,255,0.1);
}

/* OVERLAY - DIPERBAIKI */
.overlay {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(0,0,0,0.5);
    opacity: 0;
    pointer-events: none;
    transition: opacity 0.3s ease;
    z-index: 1050;
}

.overlay.active {
    opacity: 1;
    pointer-events: auto;
}

/* CONTENT */
.content {
    padding: 76px 16px 20px;
    min-height: 100vh;
    max-width: 100%;
    overflow-x: hidden;
}

/* Responsive */
@media (max-width: 768px) {
    .content {
        padding: 76px 12px 16px;
    }
    
    .sidebar {
        width: 260px;
        left: -260px;
    }
}

@media (max-width: 480px) {
    .content {
        padding: 76px 10px 14px;
    }
    
    .sidebar {
        width: 250px;
        left: -250px;
    }
    
    .sidebar a {
        padding: 12px 16px;
        font-size: 0.9rem;
    }
}
</style>
</head>

<body>

<!-- TOP BAR -->
<div class="topbar">
    <i class="bi bi-list menu-btn" onclick="toggleSidebar()"></i>
    <span class="app-title">ùòøùòºùôîùôîùôÅùô§ùô§ùô©ùôóùôñùô°ùô°</span>
    <span class="admin-badge" id="adminBadge">ADMIN</span>
</div>

<!-- SIDEBAR -->
<nav class="sidebar" id="sidebar">
    <a href="/" class="nav-link"><i class="bi bi-calendar-event"></i> <span>Upcoming</span></a>
<!--     <a href="/live" class="nav-link"><i class="bi bi-broadcast"></i> <span>Live</span></a> -->
    <a href="/finished" class="nav-link"><i class="bi bi-flag"></i> <span>Finished</span></a>
    
    <!-- NEW MENU ITEMS -->
    <div class="sidebar-divider">STATISTICS</div>
    <a href="/players" class="nav-link"><i class="bi bi-people"></i> <span>Players</span></a>
    <a href="/coaches" class="nav-link"><i class="bi bi-person-badge"></i> <span>Coaches</span></a>
    <a href="/live/updates" class="nav-link"><i class="bi bi-lightning-charge"></i> <span>Live Updates</span></a>
    
    <div class="sidebar-divider">FAVORITES</div>
    <a href="/favorites" class="nav-link"><i class="bi bi-heart"></i> <span>My Favorites</span></a>
    
    <div class="sidebar-divider">STANDINGS</div>
    <a href="/standings/PL" class="nav-link"><i class="bi bi-trophy"></i> <span>Premier League</span></a>
    <a href="/standings/PD" class="nav-link"><i class="bi bi-trophy"></i> <span>La Liga</span></a>
    <a href="/standings/SA" class="nav-link"><i class="bi bi-trophy"></i> <span>Serie A</span></a>
    <a href="/standings/BL1" class="nav-link"><i class="bi bi-trophy"></i> <span>Bundesliga</span></a>
    <a href="/standings/FL1" class="nav-link"><i class="bi bi-trophy"></i> <span>Ligue 1</span></a>
    
    <!-- Admin Menu (Conditional) -->
    <div class="sidebar-divider" id="adminDivider" style="display: none;">ADMIN</div>
    <a href="/admin" class="nav-link admin-icon" id="adminLink" style="display: none;">
        <i class="bi bi-shield-lock"></i> <span>Admin Panel</span>
    </a>
    <!-- <a href="/settings" class="nav-link admin-icon" id="settingsLink" style="display: none;">
        <i class="bi bi-gear"></i> <span>Settings</span>
    </a> -->
</nav>

<!-- OVERLAY -->
<div class="overlay" id="overlay" onclick="closeSidebar()"></div>

<!-- CONTENT -->
<main class="content">
    {% block content %}{% endblock %}
</main>

<!-- =========================
   INLINE JS - DIPERBAIKI
========================= -->
<script>
// Variabel global untuk state sidebar
let isSidebarOpen = false;

// Function untuk membuka sidebar
function openSidebar() {
    const sidebar = document.getElementById("sidebar");
    const overlay = document.getElementById("overlay");
    
    sidebar.classList.add("active");
    overlay.classList.add("active");
    document.body.style.overflow = "hidden";
    isSidebarOpen = true;
    
    console.log("Sidebar opened");
}

// Function untuk menutup sidebar
function closeSidebar() {
    const sidebar = document.getElementById("sidebar");
    const overlay = document.getElementById("overlay");
    
    sidebar.classList.remove("active");
    overlay.classList.remove("active");
    document.body.style.overflow = "";
    isSidebarOpen = false;
    
    console.log("Sidebar closed");
}

// Function untuk toggle sidebar
function toggleSidebar() {
    if (isSidebarOpen) {
        closeSidebar();
    } else {
        openSidebar();
    }
}

// Event listener untuk overlay
document.getElementById('overlay').addEventListener('click', closeSidebar);

// Event listener untuk ESC key
document.addEventListener('keydown', function(e) {
    if (e.key === 'Escape' && isSidebarOpen) {
        closeSidebar();
    }
});

// Event listener untuk link di sidebar (mobile)
document.querySelectorAll('.sidebar a').forEach(link => {
    link.addEventListener('click', function() {
        if (window.innerWidth <= 768) {
            closeSidebar();
        }
    });
});

// Check if user is admin
function checkAdmin() {
    // Check from URL parameter (for debugging)
    const urlParams = new URLSearchParams(window.location.search);
    const forceAdmin = urlParams.has('admin');
    
    // Check localStorage (for frontend toggles)
    const localAdmin = localStorage.getItem('isAdmin') === 'true';
    
    // Check if admin is logged in (from server-side)
    const isAdminLoggedIn = {{ 'true' if session.get('admin') else 'false' }};
    
    const isAdmin = forceAdmin || localAdmin || isAdminLoggedIn;
    
    if (isAdmin) {
        console.log("Admin mode activated");
        document.getElementById('adminBadge').style.display = 'block';
        document.getElementById('adminDivider').style.display = 'block';
        document.getElementById('adminLink').style.display = 'flex';
        document.getElementById('settingsLink').style.display = 'flex';
        
        // Store in localStorage for persistence
        localStorage.setItem('isAdmin', 'true');
    } else {
        localStorage.setItem('isAdmin', 'false');
    }
    
    return isAdmin;
}

// Highlight active menu based on current URL
function highlightActiveMenu() {
    const currentPath = window.location.pathname;
    const menuLinks = document.querySelectorAll('.sidebar a');
    
    menuLinks.forEach(link => {
        // Remove active class from all
        link.classList.remove('active');
        
        // Check if this link matches current path
        const linkPath = link.getAttribute('href');
        
        // Exact match
        if (linkPath === currentPath) {
            link.classList.add('active');
        }
        
        // For standings pages (dynamic)
        if (currentPath.startsWith('/standings/') && linkPath.startsWith('/standings/')) {
            const currentLeague = currentPath.split('/')[2];
            const linkLeague = linkPath.split('/')[2];
            if (currentLeague === linkLeague) {
                link.classList.add('active');
            }
        }
    });
}

// Initialize on page load
document.addEventListener('DOMContentLoaded', function() {
    checkAdmin();
    highlightActiveMenu();
    
    // Close sidebar jika klik di luar sidebar (untuk desktop)
    document.addEventListener('click', function(event) {
        const sidebar = document.getElementById('sidebar');
        const menuBtn = document.querySelector('.menu-btn');
        const overlay = document.getElementById('overlay');
        
        // Jika sidebar terbuka dan user klik di luar sidebar & bukan menu button
        if (isSidebarOpen && 
            !sidebar.contains(event.target) && 
            !menuBtn.contains(event.target) &&
            !overlay.contains(event.target)) {
            closeSidebar();
        }
    });
    
    // Fix untuk universal overflow (lebih selektif)
    setTimeout(() => {
        // Hanya terapkan ke elemen tertentu
        const elementsToFix = document.querySelectorAll('.league-name, .team-name, .app-title, .filter-btn span, .league-filter span');
        elementsToFix.forEach(el => {
            el.style.whiteSpace = 'nowrap';
            el.style.overflow = 'hidden';
            el.style.textOverflow = 'ellipsis';
        });
        
        // Fix untuk images
        document.querySelectorAll('img').forEach(img => {
            img.style.maxWidth = '100%';
            img.style.height = 'auto';
        });
    }, 100);
});

// Update active menu when navigating (for SPA-like behavior)
window.addEventListener('popstate', highlightActiveMenu);

// Debug helper
console.log("Sidebar script loaded successfully");
</script>

</body>
</html>
